<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
  <title>JARDINERA ACE - Parking Monitor</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link
    href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&family=Montserrat:wght@700;800&display=swap"
    rel="stylesheet">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="JARDINERA">
  <link rel="icon"
    href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>‚úàÔ∏è</text></svg>">
  <link rel="apple-touch-icon"
    href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><rect width=%22100%22 height=%22100%22 rx=%2220%22 fill=%22%230f172a%22/><text x=%2250%%22 y=%2250%%22 dominant-baseline=%22central%22 text-anchor=%22middle%22 font-size=%2270%22>‚úàÔ∏è</text></svg>">

  <style>
    :root {
      --primary: #f59e0b;
      --primary-glow: rgba(245, 158, 11, 0.42);
      --bg-dark: #0f172a;
      --bg-card: rgba(30, 41, 59, 0.62);
      --text-main: #f8fafc;
      --text-muted: #94a3b8;
      --accent: #38bdf8;
      --danger: #ef4444;
      --glass-border: rgba(255, 255, 255, 0.08);
      --item-height: 40px;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      -webkit-tap-highlight-color: transparent;
    }

    body {
      font-family: 'Inter', sans-serif;
      background-color: var(--bg-dark);
      color: var(--text-main);
      min-height: 100vh;
      line-height: 1.5;
      overflow-x: hidden;
      display: flex;
      flex-direction: column;
    }

    /* Bloqueo del fondo mientras el modal est√° abierto */
    html.scroll-lock,
    body.scroll-lock {
      height: 100%;
      overflow: hidden;
      overscroll-behavior: none;
    }

    body.scroll-lock {
      position: fixed;
      left: 0;
      right: 0;
      width: 100%;
    }

    .bg-glow {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: -1;
      overflow: hidden;
    }

    .glow-1 {
      position: absolute;
      top: -10%;
      right: -10%;
      width: 60vw;
      height: 60vw;
      background: radial-gradient(circle, var(--primary-glow) 0%, transparent 70%);
      filter: blur(80px);
      opacity: 0.55;
    }

    .glow-2 {
      position: absolute;
      bottom: -10%;
      left: -10%;
      width: 50vw;
      height: 50vw;
      background: radial-gradient(circle, rgba(56, 189, 248, 0.12) 0%, transparent 70%);
      filter: blur(80px);
      opacity: 0.45;
    }

    .container {
      max-width: 428px;
      margin: 0 auto;
      padding: 0 1rem;
      width: 100%;
    }

    header {
      padding: 1.5rem 0 0.75rem;
      text-align: center;
    }

    h1 {
      font-family: 'Montserrat', sans-serif;
      font-size: 1.8rem;
      font-weight: 800;
      letter-spacing: -0.03em;
      margin-bottom: 0.15rem;
    }

    .highlight {
      color: var(--primary);
      text-transform: uppercase;
      display: inline-block;
    }

    .subtitle {
      color: var(--text-muted);
      font-size: 0.65rem;
      font-weight: 600;
      letter-spacing: 0.06em;
      text-transform: uppercase;
      opacity: 0.82;
    }

    .glass {
      background: var(--bg-card);
      backdrop-filter: blur(25px);
      -webkit-backdrop-filter: blur(25px);
      border: 1px solid var(--glass-border);
      border-radius: 1.5rem;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.42);
    }

    .actions-row {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 0.6rem;
      margin-bottom: 1.25rem;
      height: 86px;
    }

    .btn-primary,
    .btn-secondary {
      border: none;
      border-radius: 1rem;
      font-weight: 900;
      cursor: pointer;
      transition: transform 0.15s ease, filter 0.15s ease, border-color 0.2s ease;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: 0.25rem;
      line-height: 1.1;
      user-select: none;
    }

    .btn-primary {
      background: var(--primary);
      color: var(--bg-dark);
      font-size: 0.95rem;
    }

    .btn-secondary {
      background: rgba(0, 0, 0, 0.25);
      color: var(--text-main);
      border: 1px solid var(--glass-border);
      font-size: 0.85rem;
    }

    .btn-primary:active,
    .btn-secondary:active {
      transform: scale(0.97);
      filter: brightness(1.08);
    }

    .btn-icon {
      font-size: 1.25rem;
    }

    .results-list {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 0.75rem;
      padding-bottom: 3rem;
    }

    .flight-card {
      padding: 0.75rem;
      position: relative;
      border-radius: 1rem;
      overflow: hidden;
      animation: slideUp 0.45s cubic-bezier(0.23, 1, 0.32, 1);
      will-change: transform, opacity;
    }

    @keyframes slideUp {
      from {
        opacity: 0;
        transform: translateY(16px);
      }

      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    /* Animaci√≥n ‚Äúnueva tarjeta‚Äù: brillo + peque√±a expansi√≥n */
    .flight-card.is-new {
      animation: slideUp 0.45s cubic-bezier(0.23, 1, 0.32, 1), popGlow 0.95s ease-out;
      border-color: rgba(245, 158, 11, 0.35);
    }

    @keyframes popGlow {
      0% {
        transform: translateY(10px) scale(0.985);
        box-shadow: 0 0 0 rgba(0, 0, 0, 0.0);
      }

      55% {
        transform: translateY(0) scale(1.015);
        box-shadow: 0 18px 55px rgba(245, 158, 11, 0.12);
      }

      100% {
        transform: translateY(0) scale(1);
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.42);
      }
    }

    /* ‚ÄúShimmer‚Äù creativo */
    .flight-card.is-new::before {
      content: "";
      position: absolute;
      inset: -40% -60%;
      background: linear-gradient(120deg,
          transparent 35%,
          rgba(245, 158, 11, 0.16) 45%,
          rgba(56, 189, 248, 0.10) 52%,
          transparent 62%);
      transform: translateX(-40%) rotate(10deg);
      animation: shimmer 0.9s ease-out;
      pointer-events: none;
    }

    @keyframes shimmer {
      from {
        transform: translateX(-55%) rotate(10deg);
        opacity: 0;
      }

      20% {
        opacity: 1;
      }

      to {
        transform: translateX(55%) rotate(10deg);
        opacity: 0;
      }
    }

    /* Animaci√≥n ‚Äúeditado‚Äù: pulso suave */
    .flight-card.is-updated {
      animation: slideUp 0.25s ease, updatePulse 0.65s ease-out;
    }

    @keyframes updatePulse {
      0% {
        box-shadow: 0 0 0 rgba(56, 189, 248, 0);
      }

      55% {
        box-shadow: 0 0 0 6px rgba(56, 189, 248, 0.12);
      }

      100% {
        box-shadow: 0 0 0 rgba(56, 189, 248, 0);
      }
    }

    .card-body.minimalist {
      display: flex;
      align-items: center;
      justify-content: space-around;
      padding: 1.25rem 0.35rem 1.15rem;
      gap: 0.35rem;
    }

    .info-item {
      text-align: center;
      width: auto;
      min-width: 110px;
    }

    /* ICONO ENCIMA DEL NOMBRE */
    .label-with-icon {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: 0.18rem;
      margin-bottom: 0.15rem;
      user-select: none;
    }

    .label-ico {
      font-size: 1.05rem;
      opacity: 0.95;
      filter: drop-shadow(0 8px 18px rgba(0, 0, 0, 0.25));
    }

    .label-text {
      font-size: 0.62rem;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      color: var(--text-muted);
      opacity: 0.78;
      font-weight: 800;
    }

    .value-big {
      font-weight: 950;
      line-height: 1.05;
      display: block;
      font-size: 2.25rem;
      letter-spacing: -0.02em;
      user-select: none;
    }

    .val-gate {
      color: var(--accent);
    }

    .val-parking {
      color: var(--primary);
    }

    .card-actions {
      display: flex;
      gap: 0.3rem;
      border-top: 1px solid var(--glass-border);
      padding-top: 0.5rem;
      margin-top: 0.3rem;
    }

    .btn-action {
      flex: 1;
      padding: 0.35rem;
      border-radius: 0.45rem;
      border: 1px solid var(--glass-border);
      font-weight: 800;
      font-size: 0.55rem;
      cursor: pointer;
      transition: transform 0.15s ease, border-color 0.2s ease, color 0.2s ease, background 0.2s ease;
      background: transparent;
      color: var(--text-muted);
    }

    .btn-action:active {
      transform: scale(0.98);
    }

    .btn-action.edit:active {
      border-color: var(--accent);
      color: var(--accent);
      background: rgba(56, 189, 248, 0.1);
    }

    .btn-action.delete:active {
      border-color: var(--danger);
      color: var(--danger);
      background: rgba(239, 68, 68, 0.1);
    }

    .empty-state {
      text-align: center;
      padding: 2rem 1rem;
      opacity: 0.25;
      font-weight: 800;
      font-size: 0.85rem;
      color: var(--text-muted);
    }

    /* Modal */
    .modal {
      display: none;
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.85);
      backdrop-filter: blur(15px);
      z-index: 1000;
      align-items: center;
      justify-content: center;
      padding: 1rem;
      overscroll-behavior: none;
    }

    .modal-content {
      width: 100%;
      max-width: 360px;
      padding: 1.75rem;
      position: relative;
      overscroll-behavior: none;
      transform-origin: center;
      animation: modalIn 0.28s cubic-bezier(0.23, 1, 0.32, 1);
    }

    @keyframes modalIn {
      from {
        opacity: 0;
        transform: translateY(10px) scale(0.985);
      }

      to {
        opacity: 1;
        transform: translateY(0) scale(1);
      }
    }

    .modal-close {
      position: absolute;
      top: 1rem;
      right: 1rem;
      background: rgba(255, 255, 255, 0.05);
      border: none;
      color: white;
      width: 28px;
      height: 28px;
      border-radius: 50%;
      font-size: 1rem;
      cursor: pointer;
      z-index: 10;
      transition: transform 0.15s ease, background 0.2s ease;
    }

    .modal-close:active {
      transform: scale(0.95);
      background: rgba(255, 255, 255, 0.08);
    }

    .modal-pickers-row {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 1rem;
      margin-bottom: 1.35rem;
      height: 120px;
    }

    .picker-selection-overlay {
      position: absolute;
      top: 50%;
      left: 0.3rem;
      right: 0.3rem;
      transform: translateY(-50%);
      height: 40px;
      background: rgba(255, 255, 255, 0.08);
      border-top: 1px solid rgba(255, 255, 255, 0.2);
      border-bottom: 1px solid rgba(255, 255, 255, 0.2);
      border-radius: 0.6rem;
      pointer-events: none;
      z-index: 2;
    }

    .modal-picker-item {
      position: relative;
      height: 100%;
      overflow: hidden;
      touch-action: none;
      overscroll-behavior: none;
      background: rgba(0, 0, 0, 0.4);
      border-radius: 0.75rem;
      mask-image: linear-gradient(to bottom, transparent, black 30%, black 70%, transparent);
      -webkit-mask-image: linear-gradient(to bottom, transparent, black 30%, black 70%, transparent);
    }

    .picker-wheel {
      position: absolute;
      width: 100%;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 0;
      margin: 0;
      cursor: grab;
      user-select: none;
      touch-action: none;
      will-change: transform;
    }

    .picker-item {
      height: 40px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.25rem;
      font-weight: 850;
      color: var(--text-muted);
      transition: color 0.2s, font-size 0.2s;
      width: 100%;
      text-align: center;
      line-height: 1.2;
    }

    .picker-item.active {
      color: var(--primary);
      font-size: 1.5rem;
    }

    /* Bot√≥n guardar: animaciones */
    .btn-save {
      width: 100%;
      height: 52px;
      border: none;
      border-radius: 0.85rem;
      background: var(--primary);
      color: var(--bg-dark);
      font-weight: 950;
      cursor: pointer;
      font-size: 0.95rem;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
      user-select: none;
      transition: transform 0.15s ease, filter 0.2s ease;
      position: relative;
      overflow: hidden;
    }

    .btn-save:active {
      transform: scale(0.98);
      filter: brightness(1.05);
    }

    .btn-save:disabled {
      opacity: 0.92;
      cursor: not-allowed;
      filter: saturate(0.9);
    }

    .save-spinner {
      width: 18px;
      height: 18px;
      border: 3px solid rgba(0, 0, 0, 0.18);
      border-top: 3px solid rgba(0, 0, 0, 0.62);
      border-radius: 50%;
      animation: spin 0.75s linear infinite;
      display: none;
    }

    @keyframes spin {
      to {
        transform: rotate(360deg);
      }
    }

    .btn-save.is-saving .save-spinner {
      display: inline-block;
    }

    .btn-save.is-saved::before {
      content: "";
      position: absolute;
      inset: -50%;
      background: radial-gradient(circle, rgba(255, 255, 255, 0.18) 0%, transparent 60%);
      animation: savedFlash 0.55s ease-out;
      pointer-events: none;
    }

    @keyframes savedFlash {
      from {
        transform: scale(0.6);
        opacity: 0;
      }

      35% {
        opacity: 1;
      }

      to {
        transform: scale(1.2);
        opacity: 0;
      }
    }
  </style>
</head>

<body>
  <div class="bg-glow">
    <div class="glow-1"></div>
    <div class="glow-2"></div>
  </div>

  <header class="container">
    <h1>JARDINERA <span class="highlight">ACE</span></h1>
    <div class="subtitle">Airport Monitor</div>
  </header>

  <main class="container">
    <div class="actions-row">
      <button id="addBtn" class="btn-primary glass" type="button">
        <span class="btn-icon">‚ûï</span>
        <span>A√ëADIR</span>
      </button>

      <button id="clearBtn" class="btn-secondary glass" type="button">
        <span class="btn-icon">üßπ</span>
        <span>LIMPIAR</span>
      </button>
    </div>

    <div id="resultsList" class="results-list">
      <div class="empty-state">Sin registros. Pulsa A√ëADIR.</div>
    </div>
  </main>

  <div id="editModal" class="modal" aria-hidden="true">
    <div class="modal-content glass" id="modalContent" role="dialog" aria-modal="true">
      <button class="modal-close" type="button" onclick="closeModal()">&times;</button>
      <h2 style="margin-bottom: 1.25rem; font-family: Montserrat; font-size: 1rem; text-align: center;">
        PUERTA / PARKING
      </h2>

      <form id="editForm">
        <div class="modal-pickers-row">
          <!-- Primero PUERTA -->
          <div style="display:flex; flex-direction:column; gap:0.3rem">
            <label style="font-size: 0.6rem; color: var(--text-muted); text-transform: uppercase; text-align: center;">
              Puerta
            </label>
            <div class="modal-picker-item" id="modalGateContainer">
              <div class="picker-selection-overlay"></div>
              <div class="picker-wheel" id="modalGateWheel"></div>
            </div>
          </div>

          <!-- Luego PARKING -->
          <div style="display:flex; flex-direction:column; gap:0.3rem">
            <label style="font-size: 0.6rem; color: var(--text-muted); text-transform: uppercase; text-align: center;">
              Parking
            </label>
            <div class="modal-picker-item" id="modalParkContainer">
              <div class="picker-selection-overlay"></div>
              <div class="picker-wheel" id="modalParkingWheel"></div>
            </div>
          </div>
        </div>

        <input type="hidden" id="editId" value="">

        <button type="submit" class="btn-save" id="saveBtn">
          <span id="saveIcon">üíæ</span>
          <span id="saveText">GUARDAR</span>
          <span class="save-spinner" id="saveSpinner" aria-hidden="true"></span>
        </button>
      </form>
    </div>
  </div>

  <script>
    const STORAGE_KEY = 'JARDINERA_ACE_MANUAL_V5';

    let entries = []; // orden de creaci√≥n (NO se ordena)
    let lastCreatedId = null;
    let lastUpdatedId = null;

    function newId() {
      if (window.crypto && crypto.randomUUID) return crypto.randomUUID();
      return 'id_' + Math.random().toString(16).slice(2) + Date.now().toString(16);
    }

    function saveData() {
      localStorage.setItem(STORAGE_KEY, JSON.stringify(entries));
    }

    function loadData() {
      try {
        const saved = localStorage.getItem(STORAGE_KEY);
        const parsed = saved ? JSON.parse(saved) : [];
        entries = Array.isArray(parsed) ? parsed : [];
      } catch {
        entries = [];
      }
      renderList();
    }

    function clearAll() {
      entries = [];
      localStorage.removeItem(STORAGE_KEY);
      renderList();
    }

    /* Bloqueo del fondo */
    let _scrollY = 0;
    function lockBackground() {
      _scrollY = window.scrollY || window.pageYOffset || 0;
      document.documentElement.classList.add('scroll-lock');
      document.body.classList.add('scroll-lock');
      document.body.style.top = `-${_scrollY}px`;
    }

    function unlockBackground() {
      document.documentElement.classList.remove('scroll-lock');
      document.body.classList.remove('scroll-lock');
      document.body.style.top = '';
      window.scrollTo(0, _scrollY);
    }

    /* Picker infinito */
    class InfinitePicker {
      constructor(wheelId, options, displayFn = null) {
        this.wheel = document.getElementById(wheelId);
        this.options = options;
        this.displayFn = displayFn || ((v) => String(v));
        this.itemHeight = 40;
        this.pickerHeight = 0;
        this.currentY = 0;
        this.isDragging = false;
        this.startY = 0;
        this.velocity = 0;
        this.lastY = 0;
        this.lastTime = 0;
        this.selectedValue = options[0];

        this.loopCount = 5;
        this.totalOptions = options.length;
        this.fullList = [];
        for (let i = 0; i < this.loopCount; i++) this.fullList.push(...options);

        this.init();
      }

      init() {
        this.wheel.innerHTML = '';
        this.fullList.forEach((opt) => {
          const div = document.createElement('div');
          div.className = 'picker-item';
          div.textContent = this.displayFn(opt);
          this.wheel.appendChild(div);
        });

        this.pickerHeight = this.wheel.parentElement.clientHeight || 120;
        const midSetIdx = Math.floor(this.loopCount / 2) * this.totalOptions;
        this.itemYOffset = (this.pickerHeight / 2) - (this.itemHeight / 2) - 2;
        this.currentY = -midSetIdx * this.itemHeight;

        this.update();

        this.wheel.addEventListener('touchstart', e => this.onStart(e), { passive: false });
        window.addEventListener('touchmove', e => this.onMove(e), { passive: false });
        window.addEventListener('touchend', () => this.onEnd());

        this.wheel.addEventListener('mousedown', e => this.onStart(e));
        window.addEventListener('mousemove', e => this.onMove(e));
        window.addEventListener('mouseup', () => this.onEnd());

        this.wheel.parentElement.addEventListener('wheel', e => {
          e.preventDefault();
          this.currentY -= Math.sign(e.deltaY) * this.itemHeight;
          this.onEnd(true);
        }, { passive: false });
      }

      refreshHeight() {
        this.pickerHeight = this.wheel.parentElement.clientHeight || 120;
        this.itemYOffset = (this.pickerHeight / 2) - (this.itemHeight / 2) - 2;
        this.update();
      }

      onStart(e) {
        if (e.cancelable) e.preventDefault();
        this.isDragging = true;
        const y = e.touches ? e.touches[0].pageY : e.pageY;
        this.startY = y - this.currentY;
        this.lastY = y;
        this.lastTime = Date.now();
        this.wheel.style.transition = 'none';
      }

      onMove(e) {
        if (!this.isDragging) return;
        if (e.cancelable) e.preventDefault();
        const y = e.touches ? e.touches[0].pageY : e.pageY;
        const now = Date.now();
        const dt = now - this.lastTime;
        if (dt > 0) this.velocity = (y - this.lastY) / dt;

        this.currentY = y - this.startY;
        this.lastY = y;
        this.lastTime = now;
        this.update();
      }

      onEnd(isWheel = false) {
        if (!this.isDragging && !isWheel) return;
        this.isDragging = false;

        let targetY = this.currentY;
        if (!isWheel && Math.abs(this.velocity) > 0.1) {
          targetY += this.velocity * 150;
        }

        const index = Math.round(-targetY / this.itemHeight);
        this.setIndex(index);
      }

      setIndex(idx) {
        const minIdx = this.totalOptions;
        const maxIdx = (this.loopCount - 1) * this.totalOptions - 1;

        if (idx < minIdx) idx += this.totalOptions;
        if (idx > maxIdx) idx -= this.totalOptions;

        this.currentY = -idx * this.itemHeight;
        this.wheel.style.transition = 'transform 0.4s cubic-bezier(0.23, 1, 0.32, 1)';
        this.update();

        this.selectedValue = this.options[idx % this.totalOptions];
      }

      setSelectedValue(val) {
        const optIdx = this.options.indexOf(val);
        if (optIdx === -1) return;
        const midSetStart = Math.floor(this.loopCount / 2) * this.totalOptions;
        this.setIndex(midSetStart + optIdx);
      }

      update() {
        this.wheel.style.transform = `translateY(${this.currentY + this.itemYOffset}px)`;
        const centerIdx = Math.round(-this.currentY / this.itemHeight);
        const items = this.wheel.querySelectorAll('.picker-item');

        items.forEach((item, i) => {
          const dist = i - centerIdx;
          const isActive = dist === 0;
          item.classList.toggle('active', isActive);

          const rotate = dist * 25;
          const translateZ = Math.abs(dist) * -10;
          const opacity = Math.max(0.1, 1 - Math.abs(dist) * 0.35);
          item.style.transform = `rotateX(${rotate}deg) translateZ(${translateZ}px)`;
          item.style.opacity = opacity;
        });
      }
    }

    let modalParkingPicker, modalGatePicker;

    function gateLabel(g) {
      return (g === 0) ? '‚Äî' : String(g);
    }

    function gateIcon(g) {
      return (g === 0) ? '‚è≥' : 'üö™';
    }

    function resetSaveButton() {
      const btn = document.getElementById('saveBtn');
      btn.disabled = false;
      btn.classList.remove('is-saving', 'is-saved');
      document.getElementById('saveIcon').textContent = 'üíæ';
      document.getElementById('saveText').textContent = 'GUARDAR';
    }

    function setSavingState() {
      const btn = document.getElementById('saveBtn');
      btn.disabled = true;
      btn.classList.add('is-saving');
      document.getElementById('saveIcon').textContent = '‚è∫Ô∏è';
      document.getElementById('saveText').textContent = 'GUARDANDO';
    }

    function setSavedState() {
      const btn = document.getElementById('saveBtn');
      btn.classList.remove('is-saving');
      btn.classList.add('is-saved');
      document.getElementById('saveIcon').textContent = '‚úÖ';
      document.getElementById('saveText').textContent = 'GUARDADO';
      // micro ‚Äúhaptic‚Äù si existe (Android/Chrome)
      if (navigator.vibrate) navigator.vibrate(18);
    }

    function openNew() {
      document.getElementById('editId').value = '';
      resetSaveButton();

      modalGatePicker.setSelectedValue(0);   // por defecto sin puerta
      modalParkingPicker.setSelectedValue(7);

      const modal = document.getElementById('editModal');
      modal.style.display = 'flex';
      modal.setAttribute('aria-hidden', 'false');
      lockBackground();

      modalGatePicker.refreshHeight();
      modalParkingPicker.refreshHeight();
    }

    function openEditById(id) {
      const item = entries.find(x => x.id === id);
      if (!item) return;

      document.getElementById('editId').value = item.id;
      resetSaveButton();

      modalGatePicker.setSelectedValue(item.gate);
      modalParkingPicker.setSelectedValue(item.parking);

      const modal = document.getElementById('editModal');
      modal.style.display = 'flex';
      modal.setAttribute('aria-hidden', 'false');
      lockBackground();

      modalGatePicker.refreshHeight();
      modalParkingPicker.refreshHeight();
    }

    function closeModal() {
      const modal = document.getElementById('editModal');
      modal.style.display = 'none';
      modal.setAttribute('aria-hidden', 'true');
      document.getElementById('editId').value = '';
      unlockBackground();
    }

    function removeById(id) {
      entries = entries.filter(x => x.id !== id);
      saveData();
      renderList();
    }

    function renderList() {
      const list = document.getElementById('resultsList');

      if (!entries.length) {
        list.innerHTML = '<div class="empty-state">Sin registros. Pulsa A√ëADIR.</div>';
        return;
      }

      // IMPORTANTE: NO SE ORDENA. Orden = creaci√≥n (tal como est√° en entries)
      const view = entries;

      list.innerHTML = view.map((e) => {
        const safeId = String(e.id).replace(/"/g, '&quot;').replace(/'/g, "\\'");
        const clsNew = (lastCreatedId && e.id === lastCreatedId) ? ' is-new' : '';
        const clsUpd = (lastUpdatedId && e.id === lastUpdatedId) ? ' is-updated' : '';

        return `
          <div class="flight-card glass${clsNew}${clsUpd}" data-id="${String(e.id)}">
            <div class="card-body minimalist">
              <div class="info-item">
                <div class="label-with-icon">
                  <div class="label-ico">${gateIcon(e.gate)}</div>
                  <div class="label-text">Puerta</div>
                </div>
                <span class="value-big val-gate">${gateLabel(e.gate)}</span>
              </div>

              <div class="info-item">
                <div class="label-with-icon">
                  <div class="label-ico">üÖøÔ∏è</div>
                  <div class="label-text">Parking</div>
                </div>
                <span class="value-big val-parking">${e.parking}</span>
              </div>
            </div>

            <div class="card-actions">
              <button class="btn-action edit" type="button" onclick="openEditById('${safeId}')">EDITAR</button>
              <button class="btn-action delete" type="button" onclick="removeById('${safeId}')">BORRAR</button>
            </div>
          </div>
        `;
      }).join('');

      // Limpia clases de animaci√≥n despu√©s de un rato (sin reordenar nada)
      if (lastCreatedId) {
        const id = lastCreatedId;
        setTimeout(() => {
          const el = document.querySelector(`.flight-card[data-id="${CSS.escape(String(id))}"]`);
          if (el) el.classList.remove('is-new');
        }, 1100);
        lastCreatedId = null;
      }

      if (lastUpdatedId) {
        const id = lastUpdatedId;
        setTimeout(() => {
          const el = document.querySelector(`.flight-card[data-id="${CSS.escape(String(id))}"]`);
          if (el) el.classList.remove('is-updated');
        }, 850);
        lastUpdatedId = null;
      }
    }

    document.addEventListener('DOMContentLoaded', () => {
      // Parkings 7..24
      const parkings = Array.from({ length: 18 }, (_, i) => i + 7);
      // Puertas: 0 = "‚Äî" + 1..12
      const gates = [0, ...Array.from({ length: 12 }, (_, i) => i + 1)];

      modalGatePicker = new InfinitePicker('modalGateWheel', gates, (v) => (v === 0 ? '‚Äî' : String(v)));
      modalParkingPicker = new InfinitePicker('modalParkingWheel', parkings, (v) => String(v));

      loadData();

      document.getElementById('addBtn').addEventListener('click', openNew);
      document.getElementById('clearBtn').addEventListener('click', clearAll);

      // Modal ‚Äútocar fuera no hace nada‚Äù + evitar scroll accidental sin romper clicks
      const modal = document.getElementById('editModal');
      const modalContent = document.getElementById('modalContent');

      modal.addEventListener('touchmove', (e) => {
        if (e.cancelable) e.preventDefault();
      }, { passive: false });

      modal.addEventListener('wheel', (e) => {
        e.preventDefault();
      }, { passive: false });

      modal.addEventListener('click', () => {
        // no hace nada
      });

      modalContent.addEventListener('click', (e) => e.stopPropagation());

      // Guardar con animaci√≥n/feedback
      document.getElementById('editForm').addEventListener('submit', async (ev) => {
        ev.preventDefault();

        // Estado "guardando" (no bloquea los eventos del bot√≥n)
        setSavingState();

        // Peque√±a pausa para que se vea la transici√≥n (y se sienta ‚Äúpremium‚Äù)
        await new Promise(r => setTimeout(r, 220));

        const gate = modalGatePicker.selectedValue;        // 0..12
        const parking = modalParkingPicker.selectedValue;  // 7..24
        const id = document.getElementById('editId').value;

        if (id) {
          // Editar existente
          entries = entries.map(x => (x.id === id ? { ...x, gate, parking } : x));
          // 1 por parking (excepto el editado)
          entries = entries.filter(x => x.id === id || x.parking !== parking);
          lastUpdatedId = id;
        } else {
          // Nuevo: 1 por parking
          const nid = newId();
          entries = entries.filter(x => x.parking !== parking);
          entries.unshift({ id: nid, gate, parking, createdAt: Date.now() });
          lastCreatedId = nid;
        }

        saveData();
        renderList();

        // Estado ‚Äúguardado‚Äù
        setSavedState();

        // Cierra con un timing agradable
        await new Promise(r => setTimeout(r, 520));
        closeModal();
      });
    });
  </script>
</body>

</html>
